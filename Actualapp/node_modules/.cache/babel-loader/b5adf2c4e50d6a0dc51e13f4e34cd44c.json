{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { Serializer } from '../../Serializer';\nimport { generateGUID } from '../../utils/generate-uuid';\nimport { Logger } from '../../utils/Logger';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nconst logger = new Logger('Alert');\nconst serializer = new Serializer();\nexport const preparePairingAlert = (shadowRoot, pairingPayload) => __awaiter(void 0, void 0, void 0, function* () {\n  const info = yield Pairing.getPairingInfo(pairingPayload, (_walletType, _wallet, keepOpen) => __awaiter(void 0, void 0, void 0, function* () {\n    if (keepOpen) {\n      return;\n    }\n\n    yield closeAlerts();\n  }), () => __awaiter(void 0, void 0, void 0, function* () {\n    switchPlatform();\n  }));\n  const container = shadowRoot.getElementById(`pairing-container`);\n\n  if (!container) {\n    throw new Error('container not found');\n  }\n\n  const buttonListWrapper = document.createElement('span');\n  container.appendChild(buttonListWrapper);\n  info.buttons.forEach(button => __awaiter(void 0, void 0, void 0, function* () {\n    const randomId = yield generateGUID();\n    const x = `\n    <div class=\"beacon-list__title\">${button.title}</div>\n\t\t<button class=\"beacon-modal__button connect__btn\">${button.text}</button>\n\t\t `;\n    const el = document.createElement('a');\n    el.id = `button_${randomId}`;\n    el.innerHTML = x;\n    buttonListWrapper.appendChild(el);\n    const buttonEl = shadowRoot.getElementById(el.id);\n\n    if (buttonEl) {\n      buttonEl.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n        button.clickHandler();\n      }));\n    }\n  }));\n  info.walletLists.forEach(list => {\n    const listWrapperEl = document.createElement('div');\n    listWrapperEl.classList.add('beacon-list__wrapper');\n    container.appendChild(listWrapperEl);\n    const listTitleEl = document.createElement('div');\n    listTitleEl.classList.add('beacon-list__title');\n    listTitleEl.innerHTML = list.title;\n    listWrapperEl.appendChild(listTitleEl);\n    const listEl = document.createElement('span');\n    listWrapperEl.appendChild(listEl);\n    list.wallets.forEach(wallet => __awaiter(void 0, void 0, void 0, function* () {\n      const altTag = `Open in ${wallet.name}`;\n      const walletKey = wallet.key;\n      const x = `\n\t\t\t<a tabindex=\"0\" alt=\"${altTag}\" id=\"wallet_${walletKey}\"\n\t\t\t target=\"_blank\" class=\"beacon-selection__list${wallet.enabled ? '' : ' disabled'}\">\n\t\t\t <div class=\"beacon-selection__name\">${wallet.name}\n\t\t\t ${wallet.enabled ? '' : '<p>Not installed</p>'}\n\t\t\t </div>\n\t\t\t ${wallet.logo ? `<div>\n\t\t\t <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n\t\t\t </div>` : '<svg class=\"beacon-selection__img\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"wallet\" class=\"svg-inline--fa fa-wallet fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\" xml:space=\"preserve\"><path d=\"M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z\"/></svg>'}\n\t\t\t</a>\n\t\t\t `;\n      const el = document.createElement('span');\n      el.innerHTML = x;\n      listEl.appendChild(el);\n      const walletEl = shadowRoot.getElementById(`wallet_${walletKey}`);\n\n      const completeHandler = event => __awaiter(void 0, void 0, void 0, function* () {\n        if (event && event.key !== 'Enter') {\n          return;\n        }\n\n        wallet.clickHandler();\n        const modalEl = shadowRoot.getElementById('beacon-modal__content');\n\n        if (modalEl && list.type !== WalletType.EXTENSION && list.type !== WalletType.IOS) {\n          modalEl.innerHTML = `${wallet.logo ? `<p class=\"beacon-alert__title\">Establishing Connection..</p>\n              <div id=\"beacon-toast-loader\" class=\"progress-line\"></div>\n              <div class=\"beacon--selected__container\">\n               <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n               <div class=\"beacon--selection__name__lg\">${wallet.name}</div>\n              </div>` : ''}\n          `;\n        }\n      });\n\n      if (walletEl) {\n        walletEl.addEventListener('click', () => completeHandler());\n        walletEl.addEventListener('keydown', completeHandler);\n      }\n    }));\n  });\n  const qr = shadowRoot.getElementById(`beacon--qr__container`);\n  const copyButton = shadowRoot.getElementById(`beacon--qr__copy`);\n  const titleEl = shadowRoot.getElementById(`beacon-title`);\n  const platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n  const mainText = shadowRoot.getElementById(`beacon-main-text`);\n  const walletList = shadowRoot.getElementById(`pairing-container`);\n  const switchButton = shadowRoot.getElementById(`beacon--switch__container`); // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n\n  const fn = () => __awaiter(void 0, void 0, void 0, function* () {\n    const code = pairingPayload ? yield serializer.serialize(yield pairingPayload.p2pSyncCode()) : '';\n    navigator.clipboard.writeText(code).then(() => {\n      if (copyButton) {\n        copyButton.innerText = 'Copied';\n      }\n\n      logger.log('Copying to clipboard was successful!');\n    }, err => {\n      logger.error('Could not copy text to clipboard: ', err);\n    });\n  });\n\n  let qrShown = false;\n\n  const showPlatform = type => __awaiter(void 0, void 0, void 0, function* () {\n    const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n\n    if (platformSwitch) {\n      platformSwitch.innerHTML = type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n    }\n\n    if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n      mainText.style.display = 'none';\n      titleEl.style.textAlign = 'center';\n      walletList.style.display = 'none';\n      switchButton.style.display = 'initial';\n\n      switch (type) {\n        case 'ios':\n          walletList.style.display = 'initial';\n          break;\n\n        case 'android':\n          walletList.style.display = 'initial';\n          break;\n\n        case 'desktop':\n          walletList.style.display = 'initial';\n          titleEl.style.textAlign = 'left';\n          mainText.style.display = 'none';\n          switchButton.style.display = 'initial';\n          break;\n\n        default:\n          if (!qrShown) {\n            const code = yield serializer.serialize(yield pairingPayload.p2pSyncCode());\n            const uri = getTzip10Link('tezos://', code);\n            const qrSVG = getQrData(uri, 'svg');\n            const qrString = qrSVG.replace('<svg', `<svg class=\"beacon-alert__image\"`);\n            qr.insertAdjacentHTML('afterbegin', qrString);\n\n            if (copyButton) {\n              copyButton.addEventListener('click', fn);\n            }\n\n            if (qr) {\n              qr.addEventListener('click', fn);\n            }\n\n            qrShown = true;\n          } // QR code\n\n\n          mainText.style.display = 'initial';\n      }\n    }\n  });\n\n  let showQr = false;\n\n  const switchPlatform = () => {\n    showPlatform(showQr ? 'none' : platform);\n    showQr = !showQr;\n  };\n\n  switchPlatform();\n  {\n    const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n\n    if (platformSwitch) {\n      platformSwitch.addEventListener('click', switchPlatform);\n    }\n  }\n});","map":{"version":3,"sources":["../../../../src/ui/alert/PairingAlert.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Serializer } from '../../Serializer';\nimport { generateGUID } from '../../utils/generate-uuid';\nimport { Logger } from '../../utils/Logger';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { closeAlerts } from './Alert';\nimport { Pairing, WalletType } from './Pairing';\nimport { getQrData } from '../../utils/qr';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nconst logger = new Logger('Alert');\nconst serializer = new Serializer();\nexport const preparePairingAlert = (shadowRoot, pairingPayload) => __awaiter(void 0, void 0, void 0, function* () {\n    const info = yield Pairing.getPairingInfo(pairingPayload, (_walletType, _wallet, keepOpen) => __awaiter(void 0, void 0, void 0, function* () {\n        if (keepOpen) {\n            return;\n        }\n        yield closeAlerts();\n    }), () => __awaiter(void 0, void 0, void 0, function* () {\n        switchPlatform();\n    }));\n    const container = shadowRoot.getElementById(`pairing-container`);\n    if (!container) {\n        throw new Error('container not found');\n    }\n    const buttonListWrapper = document.createElement('span');\n    container.appendChild(buttonListWrapper);\n    info.buttons.forEach((button) => __awaiter(void 0, void 0, void 0, function* () {\n        const randomId = yield generateGUID();\n        const x = `\n    <div class=\"beacon-list__title\">${button.title}</div>\n\t\t<button class=\"beacon-modal__button connect__btn\">${button.text}</button>\n\t\t `;\n        const el = document.createElement('a');\n        el.id = `button_${randomId}`;\n        el.innerHTML = x;\n        buttonListWrapper.appendChild(el);\n        const buttonEl = shadowRoot.getElementById(el.id);\n        if (buttonEl) {\n            buttonEl.addEventListener('click', () => __awaiter(void 0, void 0, void 0, function* () {\n                button.clickHandler();\n            }));\n        }\n    }));\n    info.walletLists.forEach((list) => {\n        const listWrapperEl = document.createElement('div');\n        listWrapperEl.classList.add('beacon-list__wrapper');\n        container.appendChild(listWrapperEl);\n        const listTitleEl = document.createElement('div');\n        listTitleEl.classList.add('beacon-list__title');\n        listTitleEl.innerHTML = list.title;\n        listWrapperEl.appendChild(listTitleEl);\n        const listEl = document.createElement('span');\n        listWrapperEl.appendChild(listEl);\n        list.wallets.forEach((wallet) => __awaiter(void 0, void 0, void 0, function* () {\n            const altTag = `Open in ${wallet.name}`;\n            const walletKey = wallet.key;\n            const x = `\n\t\t\t<a tabindex=\"0\" alt=\"${altTag}\" id=\"wallet_${walletKey}\"\n\t\t\t target=\"_blank\" class=\"beacon-selection__list${wallet.enabled ? '' : ' disabled'}\">\n\t\t\t <div class=\"beacon-selection__name\">${wallet.name}\n\t\t\t ${wallet.enabled ? '' : '<p>Not installed</p>'}\n\t\t\t </div>\n\t\t\t ${wallet.logo\n                ? `<div>\n\t\t\t <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n\t\t\t </div>`\n                : '<svg class=\"beacon-selection__img\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"wallet\" class=\"svg-inline--fa fa-wallet fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" style=\"enable-background:new 0 0 512 512;\" xml:space=\"preserve\"><path d=\"M376.2,181H152.9c-5.2,0-9.4-4.2-9.4-9.4s4.2-9.4,9.4-9.4h225c5.2,0,9.4-4.2,9.4-9.4c0-15.5-12.6-28.1-28.1-28.1H143.5c-20.7,0-37.5,16.8-37.5,37.5v187.5c0,20.7,16.8,37.5,37.5,37.5h232.7c16.4,0,29.8-12.6,29.8-28.1v-150C406,193.6,392.7,181,376.2,181z M349.8,302.9c-10.4,0-18.8-8.4-18.8-18.8s8.4-18.8,18.8-18.8s18.8,8.4,18.8,18.8S360.1,302.9,349.8,302.9z\"/></svg>'}\n\t\t\t</a>\n\t\t\t `;\n            const el = document.createElement('span');\n            el.innerHTML = x;\n            listEl.appendChild(el);\n            const walletEl = shadowRoot.getElementById(`wallet_${walletKey}`);\n            const completeHandler = (event) => __awaiter(void 0, void 0, void 0, function* () {\n                if (event && event.key !== 'Enter') {\n                    return;\n                }\n                wallet.clickHandler();\n                const modalEl = shadowRoot.getElementById('beacon-modal__content');\n                if (modalEl && list.type !== WalletType.EXTENSION && list.type !== WalletType.IOS) {\n                    modalEl.innerHTML = `${wallet.logo\n                        ? `<p class=\"beacon-alert__title\">Establishing Connection..</p>\n              <div id=\"beacon-toast-loader\" class=\"progress-line\"></div>\n              <div class=\"beacon--selected__container\">\n               <img class=\"beacon-selection__img\" src=\"${wallet.logo}\"/>\n               <div class=\"beacon--selection__name__lg\">${wallet.name}</div>\n              </div>`\n                        : ''}\n          `;\n                }\n            });\n            if (walletEl) {\n                walletEl.addEventListener('click', () => completeHandler());\n                walletEl.addEventListener('keydown', completeHandler);\n            }\n        }));\n    });\n    const qr = shadowRoot.getElementById(`beacon--qr__container`);\n    const copyButton = shadowRoot.getElementById(`beacon--qr__copy`);\n    const titleEl = shadowRoot.getElementById(`beacon-title`);\n    const platform = isAndroid(window) ? 'android' : isIOS(window) ? 'ios' : 'desktop';\n    const mainText = shadowRoot.getElementById(`beacon-main-text`);\n    const walletList = shadowRoot.getElementById(`pairing-container`);\n    const switchButton = shadowRoot.getElementById(`beacon--switch__container`);\n    // if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n    const fn = () => __awaiter(void 0, void 0, void 0, function* () {\n        const code = pairingPayload\n            ? yield serializer.serialize(yield pairingPayload.p2pSyncCode())\n            : '';\n        navigator.clipboard.writeText(code).then(() => {\n            if (copyButton) {\n                copyButton.innerText = 'Copied';\n            }\n            logger.log('Copying to clipboard was successful!');\n        }, (err) => {\n            logger.error('Could not copy text to clipboard: ', err);\n        });\n    });\n    let qrShown = false;\n    const showPlatform = (type) => __awaiter(void 0, void 0, void 0, function* () {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.innerHTML =\n                type === 'none' ? 'Pair wallet on same device' : 'Pair wallet on another device';\n        }\n        if (mainText && walletList && switchButton && copyButton && qr && titleEl) {\n            mainText.style.display = 'none';\n            titleEl.style.textAlign = 'center';\n            walletList.style.display = 'none';\n            switchButton.style.display = 'initial';\n            switch (type) {\n                case 'ios':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'android':\n                    walletList.style.display = 'initial';\n                    break;\n                case 'desktop':\n                    walletList.style.display = 'initial';\n                    titleEl.style.textAlign = 'left';\n                    mainText.style.display = 'none';\n                    switchButton.style.display = 'initial';\n                    break;\n                default:\n                    if (!qrShown) {\n                        const code = yield serializer.serialize(yield pairingPayload.p2pSyncCode());\n                        const uri = getTzip10Link('tezos://', code);\n                        const qrSVG = getQrData(uri, 'svg');\n                        const qrString = qrSVG.replace('<svg', `<svg class=\"beacon-alert__image\"`);\n                        qr.insertAdjacentHTML('afterbegin', qrString);\n                        if (copyButton) {\n                            copyButton.addEventListener('click', fn);\n                        }\n                        if (qr) {\n                            qr.addEventListener('click', fn);\n                        }\n                        qrShown = true;\n                    }\n                    // QR code\n                    mainText.style.display = 'initial';\n            }\n        }\n    });\n    let showQr = false;\n    const switchPlatform = () => {\n        showPlatform(showQr ? 'none' : platform);\n        showQr = !showQr;\n    };\n    switchPlatform();\n    {\n        const platformSwitch = shadowRoot.getElementById(`beacon-switch`);\n        if (platformSwitch) {\n            platformSwitch.addEventListener('click', switchPlatform);\n        }\n    }\n});\n//# sourceMappingURL=PairingAlert.js.map"]},"metadata":{},"sourceType":"module"}