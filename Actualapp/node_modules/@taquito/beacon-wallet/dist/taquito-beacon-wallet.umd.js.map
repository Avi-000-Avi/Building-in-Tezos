{"version":3,"file":"taquito-beacon-wallet.umd.js","sources":["../src/version.ts","../src/taquito-beacon-wallet.ts"],"sourcesContent":["\n// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"commitHash\": \"a8e9548e650215186f661033b59299ace72c9ee6\",\n    \"version\": \"9.2.0\"\n};\n/* tslint:enable */\n","/**\n * @packageDocumentation\n * @module @taquito/beacon-wallet\n */\n\nimport {\n  DAppClient,\n  DAppClientOptions,\n  RequestPermissionInput,\n  PermissionScope,\n} from '@airgap/beacon-sdk';\n\nimport {\n  createOriginationOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n  WalletDelegateParams,\n  WalletOriginateParams,\n  WalletProvider,\n  WalletTransferParams,\n} from '@taquito/taquito';\n\nexport { VERSION } from './version';\n\nexport class BeaconWalletNotInitialized implements Error {\n  name = 'BeaconWalletNotInitialized';\n  message = 'You need to initialize BeaconWallet by calling beaconWallet.requestPermissions first';\n}\n\nexport class MissingRequiredScopes implements Error {\n  name = 'MissingRequiredScopes';\n  message: string;\n\n  constructor(public requiredScopes: PermissionScope[]) {\n    this.message = `Required permissions scopes were not granted: ${requiredScopes.join(',')}`;\n  }\n}\n\nexport class BeaconWallet implements WalletProvider {\n  public client: DAppClient;\n\n  constructor(options: DAppClientOptions) {\n    this.client = new DAppClient(options);\n  }\n\n  private validateRequiredScopesOrFail(\n    permissionScopes: PermissionScope[],\n    requiredScopes: PermissionScope[]\n  ) {\n    const mandatoryScope = new Set(requiredScopes);\n\n    for (const scope of permissionScopes) {\n      if (mandatoryScope.has(scope)) {\n        mandatoryScope.delete(scope);\n      }\n    }\n\n    if (mandatoryScope.size > 0) {\n      throw new MissingRequiredScopes(Array.from(mandatoryScope));\n    }\n  }\n\n  async requestPermissions(request?: RequestPermissionInput) {\n    await this.client.requestPermissions(request);\n  }\n\n  async getPKH() {\n    const account = await this.client.getActiveAccount();\n    if (!account) {\n      throw new BeaconWalletNotInitialized();\n    }\n    return account.address;\n  }\n\n  async mapTransferParamsToWalletParams(params: WalletTransferParams) {\n    return this.removeDefaultParams(params, await createTransferOperation(this.formatParameters(params)));\n  }\n\n  async mapOriginateParamsToWalletParams(params: WalletOriginateParams) {\n      return this.removeDefaultParams(params, await createOriginationOperation(this.formatParameters(params)));\n  }\n\n  async mapDelegateParamsToWalletParams(params: WalletDelegateParams) {\n    return this.removeDefaultParams(params, await createSetDelegateOperation(this.formatParameters(params)));\n  }\n\n  formatParameters(params: any) {\n    if (params.fee) {\n      params.fee = params.fee.toString();\n    }\n    if (params.storageLimit) {\n      params.storageLimit = params.storageLimit.toString();\n    }\n    if (params.gasLimit) {\n      params.gasLimit = params.gasLimit.toString();\n    }\n    return params;\n  }\n\n  removeDefaultParams(params: WalletTransferParams|WalletOriginateParams|WalletDelegateParams, operatedParams:any) {\n    // If fee, storageLimit or gasLimit is undefined by user\n    // in case of beacon wallet, dont override it by\n    // defaults.\n    if(!params.fee) {\n      delete operatedParams.fee;\n    }\n    if(!params.storageLimit) {\n      delete operatedParams.storage_limit;\n    }\n    if(!params.gasLimit) {\n      delete operatedParams.gas_limit;\n    }\n    return operatedParams;\n  }\n\n  async sendOperations(params: any[]) {\n    const account = await this.client.getActiveAccount();\n    if (!account) {\n      throw new BeaconWalletNotInitialized();\n    }\n    const permissions = account.scopes;\n    this.validateRequiredScopesOrFail(permissions, [PermissionScope.OPERATION_REQUEST]);\n    \n    const { transactionHash } = await this.client.requestOperation({ operationDetails: params });\n    return transactionHash;\n  }\n \n  /**\n   * \n   * @description Removes all beacon values from the storage. After using this method, this instance is no longer usable. \n   * You will have to instanciate a new BeaconWallet.\n   */\n  async disconnect() {\n    await this.client.destroy();\n  }\n\n  /**\n   * \n   * @description This method removes the active account from local storage by setting it to undefined.\n   */\n  async clearActiveAccount() {\n    await this.client.setActiveAccount();\n  }\n}\n"],"names":["DAppClient","createTransferOperation","createOriginationOperation","createSetDelegateOperation","PermissionScope"],"mappings":"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"}